---
phase: 02-subagent-system
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
  - packages/arios-cli/src/commands/init.ts
autonomous: true

must_haves:
  truths:
    - "Orchestrator can evaluate state and decide which subagent to spawn"
    - "Orchestrator spawns subagents with explicit context (not chat history)"
    - "Orchestrator reads handoff files on subagent completion"
    - "Init command installs agents directory alongside commands"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/orchestrate.md"
      provides: "Orchestrator slash command"
      contains: "coordinates subagents"
    - path: "packages/arios-cli/src/commands/init.ts"
      provides: "Updated init to copy agents"
      contains: ".claude/agents"
  key_links:
    - from: "orchestrate.md"
      to: "researcher.md"
      via: "Task tool spawn"
      pattern: "spawn.*researcher"
    - from: "orchestrate.md"
      to: "planner.md"
      via: "Task tool spawn"
      pattern: "spawn.*planner"
    - from: "orchestrate.md"
      to: "executor.md"
      via: "Task tool spawn"
      pattern: "spawn.*executor"
    - from: "init.ts"
      to: "templates/.claude/agents/"
      via: "copyTemplates"
      pattern: "\\.claude/agents"
---

<objective>
Create orchestrator command and update init to install agent files.

Purpose: The orchestrator is the brain of ARIOS - it stays lean, evaluates state, spawns appropriate subagents, and integrates results. Init must now also install the agent files alongside commands.

Output: Orchestrator slash command that coordinates the subagent system, updated init command that installs agents.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-subagent-system/02-CONTEXT.md
@.planning/phases/02-subagent-system/02-RESEARCH.md

# Dependencies from prior plans
@.planning/phases/02-subagent-system/02-01-SUMMARY.md
@.planning/phases/02-subagent-system/02-02-SUMMARY.md

# Existing templates
@packages/arios-cli/templates/.claude/commands/arios/start.md
@packages/arios-cli/src/commands/init.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create orchestrator slash command</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/orchestrate.md</files>
  <action>
Create `orchestrate.md` slash command following Input-Workflow-Output structure:

**Frontmatter:**
```yaml
---
description: ARIOS orchestrator - coordinates research, planning, and execution subagents
model: opus
tools: Read, Write, Bash, Glob, Grep, Task
---
```

**Prompt structure:**

1. `## Purpose` (1-2 sentences)
   - Coordinate subagent workflow: detect state, spawn appropriate agent, integrate results
   - Stay lean - never do heavy work, delegate to subagents

2. `## Variables`
   - dynamic: $COMMAND (research|plan|execute|auto)
   - static: .arios/STATE.md, .arios/roadmaps/

3. `## Context` - What to read:
   - .arios/STATE.md - Current position
   - .arios/config.json - Project settings
   - Active roadmap and phase files

4. `## Instructions` (rules, not steps):
   - Orchestrator ONLY coordinates - spawns subagents for all heavy work
   - Each subagent gets fresh context window (not chat history fork)
   - Extract relevant info, pass explicit prompt to subagent
   - Read handoff files on subagent completion
   - Suggest `/clear` at natural breakpoints (at least after each phase)
   - Handle mismatch detection with simple user prompts

5. `## Workflow` - Decision tree:
   1. Read STATE.md to determine current position
   2. If $COMMAND == "auto": detect appropriate action from state
   3. If research needed (domain unclear): ask user, then spawn researcher
   4. If planning needed: spawn planner with findings path
   5. If execution needed: spawn executor with plan and wave number
   6. After subagent returns: read handoff file, update STATE.md, report to user
   7. Suggest next action or `/clear` if context getting full

6. `## Spawn Patterns` - How to spawn each agent:
   - Researcher: provide topic, phase context, output path
   - Planner: provide findings path, phase context, output path
   - Executor: provide plan path, wave number, task IDs, problems path

7. `## Report` - Output format:
   - Current state summary
   - Action taken (which subagent spawned)
   - Results (from handoff file)
   - Next suggested action

Keep under 120 lines total. This is the coordination brain, not a manual.
  </action>
  <verify>
    - `cat packages/arios-cli/templates/.claude/commands/arios/orchestrate.md` shows complete command
    - Has decision tree for research/plan/execute
    - Mentions spawning subagents with explicit context
    - `wc -l packages/arios-cli/templates/.claude/commands/arios/orchestrate.md` is under 120 lines
  </verify>
  <done>Orchestrator command created with state-aware subagent coordination</done>
</task>

<task type="auto">
  <name>Task 2: Update init command to install agents</name>
  <files>packages/arios-cli/src/commands/init.ts</files>
  <action>
Update the init command to also copy the agents directory:

1. Add agents directory to the copy operations. After copying `.claude/commands/`:
   ```typescript
   // Copy agent files
   await copyTemplates(
     path.join(templatesDir, '.claude', 'agents'),
     path.join(targetDir, '.claude', 'agents')
   );
   ```

2. Update the spinner/success messages to mention agents:
   - Change "Creating .claude/commands/arios/" message to include agents
   - Or add separate message: "Installing ARIOS agents..."

3. Update the final success output to list installed agents:
   ```
   Created:
     .arios/           ARIOS system files
     .claude/commands/ Slash commands (/arios:start, /arios:update)
     .claude/agents/   Subagents (researcher, planner, executor)
   ```

The copyTemplates utility from files.ts handles directory creation and file copying.
  </action>
  <verify>
    - `grep -n "agents" packages/arios-cli/src/commands/init.ts` shows agents copy
    - `cd packages/arios-cli && npx tsc --noEmit` compiles without errors
    - Run `npx tsx src/index.ts init --help` works (doesn't error)
  </verify>
  <done>Init command copies agents directory alongside commands</done>
</task>

<task type="auto">
  <name>Task 3: Verify full installation flow</name>
  <files>packages/arios-cli/src/commands/init.ts</files>
  <action>
Create a simple integration test by running init in a temp directory:

1. Create temp test directory:
   ```bash
   cd packages/arios-cli
   mkdir -p /tmp/arios-test
   cd /tmp/arios-test
   npm init -y
   ```

2. Run init from development:
   ```bash
   cd /tmp/arios-test
   node /Users/j.franke/Desktop/Windsurf/Arios_v2/packages/arios-cli/dist/index.js init
   ```

3. Verify all expected files exist:
   ```bash
   ls -la /tmp/arios-test/.arios/
   ls -la /tmp/arios-test/.claude/commands/arios/
   ls -la /tmp/arios-test/.claude/agents/
   cat /tmp/arios-test/CLAUDE.md
   ```

4. Clean up:
   ```bash
   rm -rf /tmp/arios-test
   ```

Document any issues found. This is verification, not implementation.
  </action>
  <verify>
    - .arios/ directory exists with system.md and config.json
    - .claude/commands/arios/ has start.md, update.md, orchestrate.md
    - .claude/agents/ has researcher.md, planner.md, executor.md
    - CLAUDE.md has ARIOS markers
  </verify>
  <done>Full init flow verified - all templates install correctly</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `ls packages/arios-cli/templates/.claude/commands/arios/` includes orchestrate.md
2. `ls packages/arios-cli/templates/.claude/agents/` has all three agents
3. `cd packages/arios-cli && npm run build` succeeds
4. Init in fresh directory creates complete ARIOS installation
</verification>

<success_criteria>
- Orchestrator command exists with state-aware coordination logic
- Orchestrator knows how to spawn each subagent type
- Init command installs agents directory
- Full installation includes: .arios/, .claude/commands/, .claude/agents/
- All code compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-subagent-system/02-03-SUMMARY.md`
</output>
