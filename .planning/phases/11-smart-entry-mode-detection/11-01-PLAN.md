---
phase: 11-smart-entry-mode-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/arios.md
autonomous: true

must_haves:
  truths:
    - "/arios starts a conversation to understand what user wants to build"
    - "System detects Feature-Mode vs Project-Mode from user description"
    - "Mode is confirmed with user before proceeding"
    - "Mode is stored in config.json for persistence"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/arios.md"
      provides: "Mode detection conversation flow"
      contains: "Feature-Mode"
  key_links:
    - from: "arios.md mode detection"
      to: ".planning/config.json"
      via: "mode field write"
      pattern: "mode.*feature|project"
---

<objective>
Add conversational mode detection to /arios entry point

Purpose: Enable ARIOS to detect whether user wants Feature-Mode (single-phase, scoped) or Project-Mode (multi-phase, open-ended) through natural conversation before routing to workflows.

Output: Extended arios.md with mode detection conversation that runs on fresh start, stores mode in config.json, and routes appropriately.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-smart-entry-mode-detection/11-CONTEXT.md
@.planning/phases/11-smart-entry-mode-detection/11-RESEARCH.md
@packages/arios-cli/templates/.claude/commands/arios/arios.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mode detection conversation to fresh start flow</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/arios.md</files>
  <action>
Extend the "3. Fresh Start Flow" section in arios.md to include mode detection conversation AFTER initialization.

The current flow is:
- Detect greenfield/brownfield
- Offer initialization
- If user confirms, run /arios:init

Modify to:
- Detect greenfield/brownfield
- Offer initialization
- If user confirms, run /arios:init
- THEN run mode detection conversation

Add a new section "### Mode Detection (After Init or When No Mode Set)" that includes:

1. **Opening question:** "What would you like to build?" (open-ended, let user dump mental model)

2. **Scope indicators to analyze in response:**
   - Single feature keywords: "add", "fix", "update", "change", "implement X"
   - Project keywords: "build", "create app", "new project", "from scratch", "complete"
   - Multi-feature indicators: "and also", "plus", "including", multiple features listed

3. **Mirror and confirm flow:**
   - If clearly single feature: "Got it - you want to [mirror]. This sounds like a focused feature. Feature-Mode - correct?"
   - If clearly project scope: "That sounds like a full project with multiple phases. Project-Mode - correct?"
   - If unclear after 2-3 exchanges: default to Feature-Mode (easier to upgrade)

4. **Mode confirmation:**
   - Binary choice: user confirms or describes why not
   - If user corrects: "Actually this is bigger/smaller" -> adjust mode

5. **Store mode:**
   - Write to .planning/config.json: add "mode": "feature" or "mode": "project"
   - Display: "Entering {Feature-Mode|Project-Mode}. Let's get started."

6. **Route based on mode:**
   - Feature-Mode: Route to /ideate with feature context (single-phase workflow)
   - Project-Mode: Route to /ideate with project context (roadmap workflow)

Per CONTEXT.md: Professional assistant tone. "I understand you'd like to add authentication. Let me plan that."
  </action>
  <verify>Read arios.md and confirm it contains: "Feature-Mode", mode detection conversation section, scope indicators analysis, mode confirmation prompt, config.json mode write instruction</verify>
  <done>arios.md contains mode detection conversation that asks what user wants to build, analyzes scope, confirms mode, stores in config.json</done>
</task>

<task type="auto">
  <name>Task 2: Add mode-aware resume flow</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/arios.md</files>
  <action>
Extend the "1. Resume Flow" section to be mode-aware.

Per RESEARCH.md, resume behavior differs based on existing mode:

**If STATE.md exists with mode field in frontmatter:**

For Feature-Mode resume (mode: "feature"):
```
## Welcome Back to your feature: {phaseName}

Progress: {planIndex}/{totalPlans} plans
Status: {status}

**Last activity:** {lastActivity}

---

**Options:**

1. **Continue** - {action based on status}
2. **Status** - See feature overview
3. **Finish** - Complete and archive this feature

What would you like to do? (1/2/3):
```

For Project-Mode resume (mode: "project" or no mode field - legacy):
Keep existing Welcome Back format (already correct).

**Handle "Finish" option (3) for Feature-Mode:**
- Archive feature: move .planning/phases/feature-{name}/ to .planning/archive/feature-{name}/
- Clear mode from config.json
- Reset STATE.md to clean state
- Display: "Feature complete and archived. Run /arios to start something new."

**v1.1 simplification per CONTEXT.md:**
If ROADMAP.md exists AND mode not explicitly set, always resume as Project-Mode. Don't try to detect "quick feature outside roadmap" - that's deferred to v1.2.
  </action>
  <verify>Read arios.md and confirm it contains: Feature-Mode resume message template, mode check from STATE.md frontmatter, "Finish" option handling, archive instructions</verify>
  <done>Resume flow adapts based on mode: Feature-Mode shows feature-specific progress and Finish option, Project-Mode shows existing behavior</done>
</task>

</tasks>

<verification>
- [ ] arios.md contains "Feature-Mode" and "Project-Mode" mode detection section
- [ ] Fresh start flow includes mode detection conversation after init
- [ ] Resume flow checks mode from STATE.md and adapts message
- [ ] Mode is stored in config.json
- [ ] Feature-Mode resume includes "Finish" option with archive behavior
</verification>

<success_criteria>
- /arios on fresh start asks "What would you like to build?" and detects mode
- Mode detection uses scope indicators from user response
- User confirms mode before proceeding
- Resume flow shows appropriate message based on stored mode
- Feature-Mode resume includes archive/finish option
</success_criteria>

<output>
After completion, create `.planning/phases/11-smart-entry-mode-detection/11-01-SUMMARY.md`
</output>
