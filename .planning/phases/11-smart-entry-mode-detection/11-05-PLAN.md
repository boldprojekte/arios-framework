---
phase: 11-smart-entry-mode-detection
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/ideate.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Feature-Mode ideation skips roadmap creation"
    - "Feature-Mode creates feature-{name} phase folder directly"
    - "Project-Mode ideation creates ROADMAP.md with multi-phase structure"
    - "ideate.md reads mode from config.json before workflow"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/ideate.md"
      provides: "Mode-aware ideation workflow"
      contains: "mode.*feature|project"
  key_links:
    - from: "ideate.md"
      to: "config.json mode field"
      via: "Read config.json for mode check"
      pattern: "config\\.json"
---

<objective>
Add mode awareness to ideate.md for Feature-Mode workflow

Purpose: Currently ideate.md always creates a ROADMAP.md regardless of mode. For Feature-Mode, ideation should skip roadmap creation and go directly to planning a single feature phase. This is the core gap preventing Feature-Mode from working correctly.

Output: Updated ideate.md with mode-conditional logic that branches between Feature-Mode (single phase, no roadmap) and Project-Mode (multi-phase with roadmap).
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-smart-entry-mode-detection/11-CONTEXT.md
@.planning/phases/11-smart-entry-mode-detection/11-VERIFICATION.md
@packages/arios-cli/templates/.claude/commands/arios/ideate.md
@packages/arios-cli/templates/.claude/commands/arios/arios.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mode reading to Context section</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/ideate.md</files>
  <action>
In ideate.md, find the "## Context" section (around lines 17-20).

Update it to include mode check:

```markdown
## Context

- `!ls .planning/ 2>/dev/null || echo "NO_PLANNING"`
- @.planning/STATE.md - Current project position
- @.planning/config.json - Project settings, approach, AND mode field
```

Add the config.json reference with mode emphasis.
  </action>
  <verify>Read ideate.md Context section and confirm it includes config.json with mode reference</verify>
  <done>Context section includes config.json for mode reading</done>
</task>

<task type="auto">
  <name>Task 2: Add Mode-Aware Routing section</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/ideate.md</files>
  <action>
In ideate.md, add a new "## Mode-Aware Routing" section AFTER the "## Instructions" section (before the workflow list, around line 31).

Insert:

```markdown
## Mode-Aware Routing

**Read mode from config.json before proceeding:**

1. Read `.planning/config.json` if it exists
2. Extract `mode` field: "feature" or "project"
3. If no mode field: treat as "project" (legacy behavior)

**Route based on mode:**

| Mode | Ideation Output | Next Step |
|------|-----------------|-----------|
| Feature-Mode | Single CONTEXT.md in `feature-{name}/` | `/plan` for feature |
| Project-Mode | ROADMAP.md with multi-phase structure | `/plan {phase}` for phases |

### Feature-Mode Ideation

When mode == "feature":

1. **Do NOT create ROADMAP.md** - Feature-Mode has no multi-phase roadmap
2. **Create feature phase folder:** `.planning/phases/feature-{name}/`
   - Name derived from user's feature description (kebab-case, max 30 chars)
3. **Create CONTEXT.md** in feature folder with:
   - Feature goal and scope
   - Success criteria
   - Technical considerations
4. **Update STATE.md** with feature as single phase:
   ```yaml
   phase: 1
   totalPhases: 1
   phaseName: "feature-{name}"
   ```
5. **Route to:** `/plan` (single feature phase)

### Project-Mode Ideation

When mode == "project":

1. Follow standard ideation workflow
2. Create ROADMAP.md with phases
3. Create phase folders with numbered naming: `01-xxx/`, `02-xxx/`
4. Route to: `/plan {phase}` for first phase
```

This section provides the branching logic for mode-aware ideation.
  </action>
  <verify>Read ideate.md and confirm it contains "## Mode-Aware Routing" section with Feature-Mode and Project-Mode subsections</verify>
  <done>ideate.md contains Mode-Aware Routing section with both mode paths documented</done>
</task>

<task type="auto">
  <name>Task 3: Update Workflow section with mode check</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/ideate.md</files>
  <action>
In ideate.md, find the "## Workflow" section (around line 65-67).

Update the workflow to include mode check as step 3, and renumber subsequent steps:

```markdown
## Workflow

1. Check ARIOS initialized (ls .planning/ succeeds)
   - If not: "ARIOS not initialized. Run `arios init` first."
2. Read STATE.md for current position
3. **Check mode in config.json:**
   - Read `.planning/config.json` and extract mode field
   - Default to "project" if no mode field
4. Check if approach is set (existing step, renumbered from 3):
   - Use Read tool to check .planning/config.json
   - If file exists, look for "approach" and "approachSetAt" fields
   - ... (rest of approach selection unchanged)
5. Display status: "Phase X/Y, Plan M/N | Approach: {approach}"
6. If $TOPIC provided:
   - Confirm: "Ideating on: {topic}. Proceed? (yes/no)"
7. If no $TOPIC:
   - Ask: "What would you like to explore or research?"
8. **Branch based on mode:**
   - **If mode == "feature":** Follow Feature-Mode Ideation (see Mode-Aware Routing section above)
   - **If mode == "project":** Follow Project-Mode Ideation (see Mode-Aware Routing section above)
9. After completion, show stage completion prompt (see Report section)
```

The key additions are:
- Step 3: Check mode from config.json
- Step 8: Branch based on mode (Feature-Mode vs Project-Mode)
  </action>
  <verify>Read ideate.md Workflow section and confirm it includes mode check step and mode branching</verify>
  <done>Workflow section includes mode check at step 3 and mode-based branching at step 8</done>
</task>

</tasks>

<verification>
- [ ] ideate.md reads mode from config.json in workflow
- [ ] ideate.md has Mode-Aware Routing section
- [ ] Feature-Mode skips ROADMAP.md creation
- [ ] Feature-Mode creates feature-{name} folder
- [ ] Project-Mode follows existing roadmap workflow
- [ ] Workflow steps properly renumbered after mode check insertion
</verification>

<success_criteria>
- Feature-Mode ideation creates single phase without roadmap
- Project-Mode ideation creates multi-phase roadmap (existing behavior preserved)
- Mode is read from config.json before routing decisions
- Feature folder naming follows convention: feature-{kebab-case-name}
</success_criteria>

<output>
After completion, create `.planning/phases/11-smart-entry-mode-detection/11-05-SUMMARY.md`
</output>
