---
phase: 05-execution-flow
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/agents/executor.md
  - packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Quality patterns are extracted from codebase before spawning executor"
    - "Executor receives code style guidance in context"
    - "Generated code follows detected patterns (indentation, quotes, semicolons)"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/agents/executor.md"
      provides: "Pattern-aware code generation"
      contains: "Code Style"
    - path: "packages/arios-cli/templates/.claude/commands/arios/orchestrate.md"
      provides: "Pattern extraction before executor spawn"
      contains: "extractPatterns|formatPatternsForPrompt"
  key_links:
    - from: "orchestrate.md"
      to: "enforcement.ts"
      via: "pattern extraction call instruction"
      pattern: "extractPatterns|getPatternsOrDefault"
    - from: "executor.md"
      to: "code style section"
      via: "context injection"
      pattern: "Indentation|Quotes|Semicolons"
---

<objective>
Wire quality pattern extraction and enforcement into executor context.

Purpose: Close gap where pattern extraction exists but patterns are never injected into executor prompts. Generated code should match existing codebase conventions.

Output: Updated orchestrate.md and executor.md with quality pattern integration.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/arios-cli/templates/.claude/agents/executor.md
@packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
@packages/arios-cli/src/quality/enforcement.ts
@packages/arios-cli/src/quality/pattern-extractor.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pattern extraction to orchestrator</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/orchestrate.md</files>
  <action>
Update /arios:orchestrate to extract patterns before spawning executor:

1. Add to Workflow section, before execution step:
   Insert new step: "Extract codebase patterns"
   - Analyze existing TypeScript/TSX files in src/ directory
   - Detect patterns:
     * Indentation (tabs vs spaces, how many)
     * Quote style (single vs double)
     * Semicolon usage (yes/no)
   - Extract example snippets (component, function)
   - Calculate confidence (high/medium/low based on file count)
   - Store patterns for executor context

2. Update Spawn Patterns section for Executor:
   Add code style context to executor spawn:
   ```
   **Executor:**
   Use Task tool to spawn .claude/agents/executor.md

   Provide:
   - Plan file path
   - Wave number to execute
   - Task IDs for this wave
   - Problems directory path
   - **Code Style Context:**
     ```
     Code Style:
     - Indentation: {detected, e.g., "2 spaces"}
     - Quotes: {single|double}
     - Semicolons: {yes|no}

     Example component:
     {extracted snippet if available}

     Example function:
     {extracted snippet if available}
     ```
   ```

3. Add fallback for new projects:
   If no existing code found (greenfield), provide sensible defaults:
   - Indentation: 2 spaces
   - Quotes: single
   - Semicolons: yes
   - Naming: kebab-case files, camelCase functions, PascalCase components
  </action>
  <verify>
Read updated orchestrate.md and confirm:
- Pattern extraction step documented before executor spawn
- Code Style Context included in executor spawn parameters
- Greenfield defaults documented
  </verify>
  <done>
orchestrate.md extracts patterns and includes them in executor context
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pattern enforcement to executor</name>
  <files>packages/arios-cli/templates/.claude/agents/executor.md</files>
  <action>
Update executor.md to use received code style context:

1. Update Input section:
   Add new input parameter:
   ```
   - Code Style Context (from orchestrator):
     * Indentation style
     * Quote preference
     * Semicolon usage
     * Example snippets (if available)
   ```

2. Add new section after <input>:
   ```
   <code_style>
   When generating or modifying code:
   1. Match detected indentation (use tabs or spaces as specified, use specified count)
   2. Use detected quote style consistently
   3. Follow detected semicolon convention
   4. Reference provided examples for structural patterns
   5. If no style context provided, use sensible defaults:
      - 2 spaces indentation
      - Single quotes
      - Semicolons
      - Named exports

   **CRITICAL**: Never mix styles within a file. Match existing patterns.
   </code_style>
   ```

3. Update Workflow section step 2b:
   Before "Execute task (follow action, create files)":
   Add: "Apply code style from context when creating/modifying files"

4. Add verification guidance:
   In problem_reporting section, add:
   "Style violations: If generated code doesn't match project patterns, note in problem file"
  </action>
  <verify>
Read updated executor.md and confirm:
- Code Style Context in Input section
- <code_style> section with enforcement rules
- Workflow references style application
- Problem reporting includes style violations
  </verify>
  <done>
executor.md receives and applies code style patterns to generated code
  </done>
</task>

</tasks>

<verification>
1. Read packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
2. Verify pattern extraction step exists before executor spawn
3. Verify Code Style Context included in executor spawn
4. Read packages/arios-cli/templates/.claude/agents/executor.md
5. Verify <code_style> section exists with enforcement rules
6. Verify Input section includes code style context
</verification>

<success_criteria>
- Orchestrator extracts patterns from existing code before execution
- Executor receives code style context in spawn
- Executor enforces patterns when generating code
- Greenfield projects get sensible defaults
- Style violations are flagged as problems
</success_criteria>

<output>
After completion, create `.planning/phases/05-execution-flow/05-08-SUMMARY.md`
</output>
