---
phase: 05-execution-flow
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/execute.md
  - packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Complexity is detected and displayed before execution starts"
    - "Wave schedule is built from plan frontmatter and shown to user"
    - "Execution proceeds wave by wave based on schedule"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/execute.md"
      provides: "Complexity and wave display"
      contains: "Detected:"
    - path: "packages/arios-cli/templates/.claude/commands/arios/orchestrate.md"
      provides: "Wave-based execution orchestration"
      contains: "buildWaveSchedule"
  key_links:
    - from: "orchestrate.md"
      to: "complexity.ts"
      via: "detectComplexity call instruction"
      pattern: "detectComplexity|complexity"
    - from: "orchestrate.md"
      to: "wave-scheduler.ts"
      via: "buildWaveSchedule call instruction"
      pattern: "buildWaveSchedule|wave"
---

<objective>
Wire complexity detection and wave scheduling into /arios:execute and /arios:orchestrate.

Purpose: Close gap where complexity detection and wave scheduling modules exist but are never called. Users should see complexity level and wave schedule before execution begins.

Output: Updated execute.md and orchestrate.md with complexity and wave orchestration.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/arios-cli/templates/.claude/commands/arios/execute.md
@packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
@packages/arios-cli/src/execution/complexity.ts
@packages/arios-cli/src/execution/wave-scheduler.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add complexity detection to execute command</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/execute.md</files>
  <action>
Update the /arios:execute command to display complexity before routing to orchestrator:

1. Update Workflow section after plan check (step 4-5):
   Insert new step: "Analyze phase complexity"
   - Read all PLAN.md files in current phase directory
   - Parse frontmatter to extract: wave number, depends_on array, plan ID
   - Apply complexity detection logic:
     * Simple: planCount <= 2 AND maxWave === 1
     * Complex: planCount >= 6 OR maxWave >= 3 OR avgDeps >= 2
     * Moderate: everything else
   - Display: "Detected: {level} ({planCount} plans, {maxWave} waves)"

2. Add wave schedule display after complexity:
   - Build schedule grouping plans by wave number
   - Display each wave: "Wave {n}: {plan-ids} (parallel|sequential)"

3. Update Report section to include complexity and waves:
   ```
   Complexity: {simple|moderate|complex}
   Waves: {count}

   Schedule:
   Wave 1: 05-06, 05-07, 05-08 (parallel)
   Wave 2: 05-09 (sequential)
   Wave 3: 05-10 (sequential)
   ```

The command instructs Claude to perform this analysis. Reference the complexity.ts thresholds conceptually - Claude will implement the logic when executing the command.
  </action>
  <verify>
Read updated execute.md and confirm:
- Complexity detection step in Workflow
- Wave schedule display step
- Report section shows complexity and wave schedule
  </verify>
  <done>
execute.md shows complexity level and wave schedule before execution
  </done>
</task>

<task type="auto">
  <name>Task 2: Add wave-based execution to orchestrate command</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/orchestrate.md</files>
  <action>
Update /arios:orchestrate to execute plans wave by wave:

1. Update Workflow section, execution flow (step 5):
   Current: "If execution needed: Spawn executor with plan path..."

   New: "If execution needed:
   a. Build wave schedule from phase plan frontmatter
   b. For each wave in order:
      - Spawn executor(s) for plans in this wave
      - If wave has multiple plans: spawn in parallel (concurrent Tasks)
      - If wave has single plan: spawn sequentially
      - Wait for wave completion before starting next wave
   c. After each wave: report wave status"

2. Update Spawn Patterns section for Executor:
   Add wave execution pattern:
   ```
   **Executor (wave execution):**
   For each wave in schedule:
     If wave.canParallelize (multiple plans):
       Spawn executor for each plan in parallel
       Wait for all executors in wave to complete
     Else:
       Spawn executor for single plan
       Wait for completion

     Report wave completion before next wave
   ```

3. Update Report section to show wave progress:
   ```
   ### Wave Progress
   Wave 1: ✓ Complete (2/2 plans)
   Wave 2: ✓ Complete (1/1 plans)
   Wave 3: → In progress (0/1 plans)
   ```

4. Add wave context to executor spawn:
   - Include wave number in executor context
   - Include plans-in-wave for progress tracking
  </action>
  <verify>
Read updated orchestrate.md and confirm:
- Wave-based execution loop documented
- Parallel execution for multi-plan waves
- Sequential wave ordering maintained
- Wave progress reporting in output
  </verify>
  <done>
orchestrate.md executes plans wave by wave with parallel execution within waves
  </done>
</task>

</tasks>

<verification>
1. Read packages/arios-cli/templates/.claude/commands/arios/execute.md
2. Verify complexity detection is documented with thresholds
3. Verify wave schedule display format matches wave-scheduler.ts
4. Read packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
5. Verify wave-based execution loop is documented
6. Verify parallel execution within waves is specified
</verification>

<success_criteria>
- execute.md displays complexity level and wave schedule
- orchestrate.md executes wave by wave with parallelization
- Wave progress is visible to user during execution
- Complexity thresholds match complexity.ts implementation
</success_criteria>

<output>
After completion, create `.planning/phases/05-execution-flow/05-07-SUMMARY.md`
</output>
