---
phase: 05-execution-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/src/execution/complexity.ts
  - packages/arios-cli/src/execution/wave-scheduler.ts
  - packages/arios-cli/src/types/execution.ts
autonomous: true

must_haves:
  truths:
    - "Complexity level detected from plan frontmatter (simple/moderate/complex)"
    - "Wave schedule built from plan dependencies"
    - "Brief complexity message generated for CLI output"
  artifacts:
    - path: "packages/arios-cli/src/execution/complexity.ts"
      provides: "detectComplexity function"
      exports: ["detectComplexity", "ComplexityResult"]
    - path: "packages/arios-cli/src/execution/wave-scheduler.ts"
      provides: "Wave scheduling utilities"
      exports: ["buildWaveSchedule", "formatWaveMessage", "WaveSchedule"]
    - path: "packages/arios-cli/src/types/execution.ts"
      provides: "Execution type definitions"
      exports: ["ComplexityLevel", "ComplexityResult", "WaveSchedule", "PlanMeta"]
  key_links:
    - from: "complexity.ts"
      to: "types/execution.ts"
      via: "import"
      pattern: "import.*from.*types/execution"
    - from: "wave-scheduler.ts"
      to: "types/execution.ts"
      via: "import"
      pattern: "import.*from.*types/execution"
---

<objective>
Create complexity detection and wave scheduling modules for phase execution.

Purpose: Enable execution engine to adapt to project complexity (simple tasks in one wave, complex in phased waves) as specified in Phase 5 requirements.
Output: TypeScript modules for complexity detection and wave scheduling with proper types.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-execution-flow/05-CONTEXT.md
@.planning/phases/05-execution-flow/05-RESEARCH.md

# Existing patterns to follow
@packages/arios-cli/src/types/handoff.ts
@packages/arios-cli/src/utils/handoff.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create execution types</name>
  <files>packages/arios-cli/src/types/execution.ts</files>
  <action>
Create TypeScript type definitions for execution module:

1. `ComplexityLevel` - type alias: 'simple' | 'moderate' | 'complex'
2. `PlanMeta` - type alias with fields:
   - id: string (e.g., "05-01")
   - phase: string (e.g., "05-execution-flow")
   - plan: number (1, 2, 3...)
   - wave: number (1, 2, 3...)
   - dependsOn: string[] (plan IDs this depends on)
   - filesModified: string[]
   - autonomous: boolean
   - estimatedTasks: number (count of tasks in plan)
3. `ComplexityResult` - type alias with fields:
   - level: ComplexityLevel
   - waves: number
   - planCount: number
   - message: string (brief CLI message per CONTEXT.md: "Detected: complex (3 waves)")
4. `WaveSchedule` - type alias with fields:
   - wave: number
   - plans: string[] (plan IDs)
   - canParallelize: boolean

Follow existing patterns from types/handoff.ts:
- Use type aliases, not interfaces (per 02-01 decision)
- JSDoc comments for each type
- ESM export syntax
  </action>
  <verify>npx tsc --noEmit packages/arios-cli/src/types/execution.ts</verify>
  <done>Execution types compile without errors and export ComplexityLevel, PlanMeta, ComplexityResult, WaveSchedule</done>
</task>

<task type="auto">
  <name>Task 2: Implement complexity detection</name>
  <files>packages/arios-cli/src/execution/complexity.ts</files>
  <action>
Create complexity detection module:

1. Import types from ../types/execution.js
2. `detectComplexity(plans: PlanMeta[]): ComplexityResult` function:
   - Handle empty plans array (return simple, 0 waves)
   - Calculate maxWave from plan.wave values
   - Calculate avgDeps from plan.dependsOn lengths
   - Apply hybrid signal thresholds per RESEARCH.md:
     - Simple: planCount <= 2 AND maxWave === 1
     - Complex: planCount >= 6 OR maxWave >= 3 OR avgDeps >= 2
     - Moderate: everything else
   - Generate brief message: `Detected: ${level} (${planCount} plan${s}, ${waves} wave${s})`

Follow existing utils patterns:
- JSDoc comments
- ESM imports with .js extensions
- Export function at bottom

Do NOT use typescript-graph library - simple threshold logic is sufficient per RESEARCH.md "Don't Hand-Roll" section noting manual wave assignment is fine for small graphs.
  </action>
  <verify>npx tsc --noEmit packages/arios-cli/src/execution/complexity.ts</verify>
  <done>detectComplexity function compiles and exports, handles all three complexity levels</done>
</task>

<task type="auto">
  <name>Task 3: Implement wave scheduler</name>
  <files>packages/arios-cli/src/execution/wave-scheduler.ts</files>
  <action>
Create wave scheduling module:

1. Import types from ../types/execution.js
2. `buildWaveSchedule(plans: PlanMeta[]): WaveSchedule[]` function:
   - Group plans by wave number (pre-computed in PLAN.md frontmatter by planner)
   - Sort waves numerically
   - For each wave, create WaveSchedule with canParallelize = plans.length > 1
   - Return sorted array of WaveSchedule
3. `formatWaveMessage(schedule: WaveSchedule[]): string` function:
   - Format as "Wave {n}: {plan-ids} (parallel)" or "(sequential)"
   - One line per wave
   - Return joined string for CLI output

Per CONTEXT.md: "Minimal progress output in CLI" - keep messages brief.

Follow existing utils patterns from utils/handoff.ts.
  </action>
  <verify>npx tsc --noEmit packages/arios-cli/src/execution/wave-scheduler.ts</verify>
  <done>buildWaveSchedule and formatWaveMessage functions compile and export</done>
</task>

</tasks>

<verification>
Run TypeScript compilation for all execution module files:
```bash
cd packages/arios-cli && npx tsc --noEmit
```
All files should compile without errors.
</verification>

<success_criteria>
- Complexity detection returns appropriate level for:
  - 1-2 plans, 1 wave -> simple
  - 3-5 plans, 2 waves, low deps -> moderate
  - 6+ plans or 3+ waves or high deps -> complex
- Wave scheduler groups plans correctly by wave number
- Message format matches CONTEXT.md specification: "Detected: complex (3 waves)"
- All types exported and importable
</success_criteria>

<output>
After completion, create `.planning/phases/05-execution-flow/05-01-SUMMARY.md`
</output>
