---
phase: 12-state-dashboard-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
  - packages/arios-cli/templates/.claude/commands/arios/ideate.md
  - packages/arios-cli/templates/.claude/commands/arios/plan.md
autonomous: true

must_haves:
  truths:
    - "Feature-Mode uses .planning/features/feature-{name}/ folder"
    - "Feature state file is at feature folder/STATE.md"
    - "Feature archive goes to .planning/archive/feature-{name}/"
    - "Multiple features can be active simultaneously"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/orchestrate.md"
      provides: "Feature folder path logic and archive behavior"
      contains: ".planning/features"
    - path: "packages/arios-cli/templates/.claude/commands/arios/ideate.md"
      provides: "Feature folder creation in ideation"
      contains: "features/feature-"
  key_links:
    - from: "mode detection (config.json)"
      to: "folder path selection"
      via: "orchestrate.md routing"
      pattern: "mode.*feature|features/feature"
---

<objective>
Implement Feature-Mode folder structure with separate state paths and archive behavior.

Purpose: Feature-Mode work should be isolated in .planning/features/feature-{name}/ with its own STATE.md, and archive to .planning/archive/ on completion.
Output: Updated orchestrate.md with Feature-Mode paths, updated ideate.md and plan.md for feature folder creation.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-state-dashboard-polish/12-CONTEXT.md
@packages/arios-cli/templates/.claude/commands/arios/orchestrate.md
@packages/arios-cli/templates/.claude/commands/arios/ideate.md
@packages/arios-cli/templates/.claude/commands/arios/plan.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Feature-Mode path logic to orchestrate.md</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/orchestrate.md</files>
  <action>
  Add a "Mode-Aware Path Resolution" section near the top of orchestrate.md (after context loading, before state reading).

  Content:
  ```markdown
  ### Mode-Aware Path Resolution

  Read mode from config.json:
  ```bash
  !cat .planning/config.json 2>/dev/null | grep -o '"mode"[[:space:]]*:[[:space:]]*"[^"]*"' | cut -d'"' -f4 || echo "project"
  ```

  **Path resolution by mode:**

  **Project-Mode (default):**
  - STATE.md: `.planning/STATE.md`
  - Plans: `.planning/phases/{phase}-{name}/{phase}-{plan}-PLAN.md`
  - Summaries: `.planning/phases/{phase}-{name}/{phase}-{plan}-SUMMARY.md`
  - Roadmap: `.planning/ROADMAP.md`

  **Feature-Mode:**
  - Read feature name from config.json: `!cat .planning/config.json | grep -o '"feature_name"[[:space:]]*:[[:space:]]*"[^"]*"' | cut -d'"' -f4`
  - STATE.md: `.planning/features/feature-{name}/STATE.md`
  - Plans: `.planning/features/feature-{name}/{plan}-PLAN.md`
  - Summaries: `.planning/features/feature-{name}/{plan}-SUMMARY.md`
  - No roadmap (feature is single-phase by definition)

  **Multiple active features:**
  - Each feature has its own folder
  - config.json stores `active_feature` for current context
  - User can switch with `/arios:switch-feature {name}`

  Store resolved paths in working variables for use throughout orchestration.
  ```

  Also add a "Feature Archive" section for completion behavior:
  ```markdown
  ### Feature Archive (Feature-Mode only)

  When Feature-Mode work is marked complete:
  1. Move entire feature folder to archive:
     ```bash
     mv .planning/features/feature-{name} .planning/archive/feature-{name}
     ```
  2. Clear mode and feature_name from config.json
  3. Show completion message: "Feature '{name}' archived to .planning/archive/"

  Archive preserves all state and summaries for reference.
  ```
  </action>
  <verify>Read orchestrate.md and confirm "Mode-Aware Path Resolution" and "Feature Archive" sections exist</verify>
  <done>orchestrate.md contains Feature-Mode path resolution using .planning/features/feature-{name}/ and archive behavior</done>
</task>

<task type="auto">
  <name>Task 2: Update ideate.md for Feature-Mode folder creation</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/ideate.md</files>
  <action>
  Find the Mode-Aware Routing section (added in Phase 11-05).

  Update Feature-Mode path in step 8 to use the new folder structure:

  Where it says to create feature folder, ensure it specifies:
  ```markdown
  **Feature-Mode Path:**
  - Create folder: `.planning/features/feature-{name}/`
  - Create STATE.md at: `.planning/features/feature-{name}/STATE.md`
  - Feature name derived from ideation topic (slugified: lowercase, hyphens)
  ```

  If this isn't already specified, add it. The feature name should be:
  - Derived from the feature description (e.g., "add authentication" -> "add-authentication")
  - Stored in config.json as `feature_name`
  - Used to create the folder path

  Ensure the ideation output for Feature-Mode includes:
  - Feature folder path
  - Initial STATE.md with basic frontmatter (status: ideation-complete)
  </action>
  <verify>Read ideate.md and confirm Feature-Mode creates folder at `.planning/features/feature-{name}/`</verify>
  <done>ideate.md Feature-Mode routing creates feature folder at .planning/features/feature-{name}/ with STATE.md</done>
</task>

<task type="auto">
  <name>Task 3: Update plan.md for Feature-Mode paths</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/plan.md</files>
  <action>
  Find the Mode-Aware section (added in Phase 11-06).

  Ensure the Feature-Mode path uses the correct folder structure:
  ```markdown
  **Feature-Mode:**
  - Read feature name from config.json
  - Plans written to: `.planning/features/feature-{name}/{plan}-PLAN.md`
  - No phase numbering (features are single-phase)
  - Plan numbers: 01, 02, 03...
  ```

  The plan.md should check mode from config.json and:
  - Project-Mode: Use `.planning/phases/` path
  - Feature-Mode: Use `.planning/features/feature-{name}/` path

  Ensure the planner understands it's working within a feature folder when in Feature-Mode.
  </action>
  <verify>Read plan.md and confirm Feature-Mode writes plans to `.planning/features/feature-{name}/`</verify>
  <done>plan.md Feature-Mode routing writes plans to feature folder path</done>
</task>

</tasks>

<verification>
- orchestrate.md has Mode-Aware Path Resolution section
- orchestrate.md has Feature Archive section
- ideate.md creates feature folder at correct path
- plan.md writes plans to feature folder in Feature-Mode
- Paths are consistent across all three files
</verification>

<success_criteria>
- Feature-Mode state isolation: each feature has its own folder
- Archive behavior defined: completed features move to .planning/archive/
- Multiple features can exist (separate folders)
- Path resolution is mode-aware throughout workflow
</success_criteria>

<output>
After completion, create `.planning/phases/12-state-dashboard-polish/12-04-SUMMARY.md`
</output>
