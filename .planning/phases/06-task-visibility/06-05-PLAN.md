---
phase: 06-task-visibility
plan: 05
type: execute
wave: 3
depends_on: ["06-02", "06-04"]
files_modified:
  - packages/arios-dashboard/src/client/lines.js
  - packages/arios-dashboard/src/client/kanban.js
  - packages/arios-dashboard/src/client/app.js
autonomous: true

must_haves:
  truths:
    - "Dependencies display as connecting lines between task cards"
    - "Lines update position when view changes or window resizes"
    - "Lines are only drawn in Kanban view (not List)"
  artifacts:
    - path: "packages/arios-dashboard/src/client/lines.js"
      provides: "Leader-line dependency visualization"
      exports: ["drawDependencyLines", "clearLines", "updateLinePositions"]
  key_links:
    - from: "packages/arios-dashboard/src/client/lines.js"
      to: "leader-line"
      via: "LeaderLine constructor"
      pattern: "LeaderLine"
    - from: "packages/arios-dashboard/src/client/kanban.js"
      to: "packages/arios-dashboard/src/client/lines.js"
      via: "drawDependencyLines call"
      pattern: "drawDependencyLines"
---

<objective>
Add dependency line visualization using Leader-line to show relationships between tasks in the Kanban view.

Purpose: Visual dependency lines help users understand task relationships at a glance. This is the "connecting lines between related tasks" feature from CONTEXT.md.
Output: SVG lines connecting dependent tasks in Kanban view.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-task-visibility/06-CONTEXT.md
@.planning/phases/06-task-visibility/06-RESEARCH.md
@packages/arios-dashboard/src/client/index.html
@packages/arios-dashboard/src/client/kanban.js
@packages/arios-dashboard/src/client/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement dependency line drawing</name>
  <files>packages/arios-dashboard/src/client/lines.js</files>
  <action>
Create dependency line module using Leader-line:

1. Import leader-line from CDN (browser-only library):
```javascript
// Leader-line is a browser-only library, load via script tag in HTML
// This module assumes LeaderLine is available globally

const lines = [];

export function clearLines() {
  for (const line of lines) {
    line.remove();
  }
  lines.length = 0;
}

export function drawDependencyLines(tasks) {
  clearLines();

  // Only draw in Kanban view
  const kanbanBoard = document.getElementById('kanban-board');
  if (kanbanBoard.classList.contains('hidden')) return;

  for (const task of tasks) {
    if (!task.dependsOn || task.dependsOn.length === 0) continue;

    const targetEl = document.querySelector(`[data-task-id="${task.id}"]`);
    if (!targetEl) continue;

    for (const depId of task.dependsOn) {
      const sourceEl = document.querySelector(`[data-task-id="${depId}"]`);
      if (!sourceEl) continue;

      try {
        const line = new LeaderLine(
          sourceEl,
          targetEl,
          {
            color: 'rgba(124, 92, 255, 0.5)', // accent color, semi-transparent
            size: 2,
            path: 'fluid',
            startSocket: 'right',
            endSocket: 'left',
            startPlug: 'disc',
            endPlug: 'arrow1',
            dash: { len: 4, gap: 4 }
          }
        );
        lines.push(line);
      } catch (e) {
        // Skip if elements aren't properly positioned
        console.warn(`Could not draw line from ${depId} to ${task.id}:`, e);
      }
    }
  }
}

export function updateLinePositions() {
  for (const line of lines) {
    try {
      line.position();
    } catch (e) {
      // Ignore position errors for hidden elements
    }
  }
}
```

2. Export functions for external use:
- clearLines() - remove all lines
- drawDependencyLines(tasks) - draw lines for all dependencies
- updateLinePositions() - update positions after layout change
  </action>
  <verify>`cat packages/arios-dashboard/src/client/lines.js | grep "export function drawDependencyLines"` shows export</verify>
  <done>Leader-line dependency drawing module complete</done>
</task>

<task type="auto">
  <name>Task 2: Integrate lines into Kanban and app.js</name>
  <files>
    packages/arios-dashboard/src/client/kanban.js
    packages/arios-dashboard/src/client/app.js
    packages/arios-dashboard/src/client/index.html
  </files>
  <action>
1. Add Leader-line script to index.html (before app.js):
```html
<script src="https://cdn.jsdelivr.net/npm/leader-line@1.2.4/leader-line.min.js"></script>
```

2. Update kanban.js to call line drawing after render:
```javascript
import { drawDependencyLines } from './lines.js';

export function renderKanban(tasks, onTaskClick) {
  // ... existing rendering code ...

  // Draw dependency lines after cards are in DOM
  // Use requestAnimationFrame to ensure layout is complete
  requestAnimationFrame(() => {
    drawDependencyLines(tasks);
  });
}
```

3. Update app.js to manage line lifecycle:

Import line functions:
```javascript
import { clearLines, updateLinePositions } from './lines.js';
```

Clear lines on view switch (in setView function):
```javascript
function setView(view) {
  state.currentView = view;
  clearLines(); // Clear before re-render
  render();

  // Update toggle button active state
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.view === view);
  });
}
```

Clear lines on tab switch:
```javascript
function setTab(tab) {
  state.currentTab = tab;
  clearLines();
  // ... existing tab switching code ...
}
```

Add resize handler for line repositioning:
```javascript
window.addEventListener('resize', () => {
  if (state.currentView === 'kanban' && state.currentTab === 'tasks') {
    updateLinePositions();
  }
});
```

Add scroll handler for Kanban container:
```javascript
document.getElementById('kanban-board').addEventListener('scroll', () => {
  updateLinePositions();
});
```
  </action>
  <verify>
    `grep "leader-line" packages/arios-dashboard/src/client/index.html` shows script tag
    `grep "drawDependencyLines" packages/arios-dashboard/src/client/kanban.js` shows call
  </verify>
  <done>Lines integrated into Kanban with proper lifecycle management</done>
</task>

</tasks>

<verification>
1. Start dashboard and load with tasks that have dependencies
2. Verify lines connect dependent tasks (arrow from dependency to dependent)
3. Resize window, verify lines update position
4. Switch to List view, verify lines are cleared
5. Switch back to Kanban, verify lines are redrawn
6. Switch to Roadmap tab, verify lines are cleared
</verification>

<success_criteria>
- Dependency lines render between task cards
- Lines use fluid path with arrow endpoints
- Lines clear when switching views
- Lines update position on resize/scroll
- No console errors from leader-line
</success_criteria>

<output>
After completion, create `.planning/phases/06-task-visibility/06-05-SUMMARY.md`
</output>
