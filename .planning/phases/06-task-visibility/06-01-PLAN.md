---
phase: 06-task-visibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-dashboard/package.json
  - packages/arios-dashboard/tsconfig.json
  - packages/arios-dashboard/src/types/dashboard.ts
  - packages/arios-dashboard/src/server/index.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard server starts and listens on port 3456"
    - "HTTP requests to / serve static HTML files"
    - "SSE endpoint /events accepts connections and keeps them alive"
  artifacts:
    - path: "packages/arios-dashboard/package.json"
      provides: "Package configuration with dependencies"
      contains: "chokidar"
    - path: "packages/arios-dashboard/src/types/dashboard.ts"
      provides: "TypeScript type definitions"
      exports: ["Task", "Phase", "DashboardState"]
    - path: "packages/arios-dashboard/src/server/index.ts"
      provides: "HTTP server with SSE endpoint"
      exports: ["startServer"]
  key_links:
    - from: "packages/arios-dashboard/src/server/index.ts"
      to: "node:http"
      via: "createServer"
      pattern: "createServer"
---

<objective>
Create the dashboard package foundation with TypeScript types and HTTP server that serves static files and provides an SSE endpoint for real-time updates.

Purpose: Establishes the server infrastructure that all dashboard features will build upon. The SSE endpoint enables real-time file change broadcasting to connected browsers.
Output: Working HTTP server that can serve static files and accept SSE connections.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-task-visibility/06-CONTEXT.md
@.planning/phases/06-task-visibility/06-RESEARCH.md
@packages/arios-cli/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard package structure</name>
  <files>
    packages/arios-dashboard/package.json
    packages/arios-dashboard/tsconfig.json
  </files>
  <action>
Create the arios-dashboard package directory structure:

```
packages/arios-dashboard/
  src/
    server/
    client/
    types/
  package.json
  tsconfig.json
```

package.json should include:
- name: "arios-dashboard"
- type: "module" (ESM-only per project convention)
- main: "./dist/server/index.js"
- scripts: build (tsc), dev (tsx src/server/index.ts)
- dependencies: chokidar@^5, marked@^16, gray-matter@^4.0.3
- devDependencies: @types/node@^22, typescript@^5.7, tsx@^4
- engines: node >=22.0.0

tsconfig.json should extend arios-cli pattern:
- target: ES2022
- module: NodeNext
- moduleResolution: NodeNext
- outDir: ./dist
- rootDir: ./src
- strict: true
  </action>
  <verify>
    `ls packages/arios-dashboard/package.json packages/arios-dashboard/tsconfig.json` shows both files exist
    `cat packages/arios-dashboard/package.json | grep chokidar` shows dependency
  </verify>
  <done>Package structure exists with correct dependencies and TypeScript configuration</done>
</task>

<task type="auto">
  <name>Task 2: Define dashboard TypeScript types</name>
  <files>packages/arios-dashboard/src/types/dashboard.ts</files>
  <action>
Create TypeScript types per RESEARCH.md specification:

```typescript
export type TaskStatus = 'pending' | 'in-progress' | 'complete';

export type Task = {
  id: string;           // "05-01" (phase-plan)
  phase: string;        // "05-execution-flow"
  plan: number;         // 1
  wave: number;         // 1
  dependsOn: string[];  // ["05-00"]
  status: TaskStatus;
  name?: string;        // From objective section
  summary?: string;     // From SUMMARY.md if exists
  duration?: string;    // From SUMMARY.md
  completedAt?: string; // From SUMMARY.md
  filesModified?: string[]; // From frontmatter
};

export type Phase = {
  id: number;           // 5
  name: string;         // "execution-flow"
  fullName: string;     // "05-execution-flow"
  status: 'complete' | 'in-progress' | 'pending';
  plansTotal: number;
  plansComplete: number;
};

export type ConnectionStatus = 'connected' | 'disconnected' | 'reconnecting';

export type DashboardState = {
  tasks: Task[];
  phases: Phase[];
  currentPhase: number;
  currentPlan: number;
  roadmap: string;      // Raw ROADMAP.md for rendering
  connectionStatus: ConnectionStatus;
};

export type FileChangeEvent = {
  event: 'add' | 'change' | 'unlink';
  path: string;
  data?: Task | Phase | DashboardState;
};

export type SSEMessage = {
  type: 'initial' | 'update' | 'heartbeat';
  payload: DashboardState | FileChangeEvent | null;
};
```
  </action>
  <verify>`cat packages/arios-dashboard/src/types/dashboard.ts | grep "export type Task"` shows type export</verify>
  <done>All dashboard types exported and ready for use by server and parser</done>
</task>

<task type="auto">
  <name>Task 3: Implement HTTP server with SSE endpoint</name>
  <files>packages/arios-dashboard/src/server/index.ts</files>
  <action>
Create HTTP server using node:http (not express - keep minimal per research):

1. Create server on port 3456 (configurable via PORT env var)
2. Handle routes:
   - GET / and /index.html -> serve client/index.html
   - GET /*.css -> serve client/*.css with text/css
   - GET /*.js -> serve client/*.js with application/javascript
   - GET /events -> SSE endpoint

3. SSE endpoint implementation:
   - Set headers: Content-Type: text/event-stream, Cache-Control: no-cache, Connection: keep-alive, X-Accel-Buffering: no
   - Track connected clients in Set<ServerResponse>
   - Keep-alive comment every 30s to prevent timeout
   - On client disconnect, remove from Set
   - Export broadcast(message: SSEMessage) function for watcher to call

4. Export startServer(planningDir: string): { port: number, broadcast: (msg: SSEMessage) => void }
   - planningDir is passed to watcher (next plan)
   - Returns port and broadcast function

5. Static file serving:
   - Read files from __dirname/../client/ (relative to compiled JS)
   - Handle 404 for missing files
   - Set appropriate Content-Type headers

Use pattern from RESEARCH.md Pattern 2 (SSE Server Response).
  </action>
  <verify>
    `cd packages/arios-dashboard && npm install && npx tsc --noEmit` verifies TypeScript compilation without errors
  </verify>
  <done>Server starts, serves static files, and SSE endpoint accepts connections with keep-alive</done>
</task>

</tasks>

<verification>
1. `ls packages/arios-dashboard/src/types/dashboard.ts packages/arios-dashboard/src/server/index.ts` - both files exist
2. `cd packages/arios-dashboard && npm install` - dependencies install without errors
3. `cd packages/arios-dashboard && npx tsc --noEmit` - TypeScript compiles without errors
4. Server starts and responds to HTTP requests on port 3456
</verification>

<success_criteria>
- Dashboard package exists with correct structure
- TypeScript types defined and exportable
- HTTP server starts and serves static files
- SSE endpoint accepts connections and sends keep-alive
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-task-visibility/06-01-SUMMARY.md`
</output>
