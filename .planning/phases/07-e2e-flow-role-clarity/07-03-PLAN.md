---
phase: 07-e2e-flow-role-clarity
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/arios-cli/templates/.claude/commands/arios/arios.md
autonomous: true

must_haves:
  truths:
    - "/arios offers structured resume options when valid state exists"
    - "Resume prompt shows phase name and last activity, not just numbers"
    - "User gets clear options: Continue, Status, or Other"
    - "/arios feels like a friendly entry point, not a status dump"
    - "Greenfield/brownfield detection still works correctly after changes"
  artifacts:
    - path: "packages/arios-cli/templates/.claude/commands/arios/arios.md"
      provides: "Enhanced resume flow with AskUserQuestion pattern"
      contains: "Welcome back"
  key_links:
    - from: "arios.md"
      to: ".planning/STATE.md"
      via: "Read state and offer resume"
      pattern: "STATE.md"
    - from: "arios.md"
      to: "greenfield/brownfield detection"
      via: "Preserves existing detection logic"
      pattern: "greenfield|brownfield|find.*-name"
---

<objective>
Enhance /arios smart entry to provide a friendly resume experience with structured options.

Purpose: /arios should feel like a helpful starting point that helps users pick up where they left off. Instead of dumping state, it offers clear choices for what to do next.

Output: Updated arios.md with enhanced resume flow using AskUserQuestion-style prompting.
</objective>

<execution_context>
@/Users/j.franke/.claude/get-shit-done/workflows/execute-plan.md
@/Users/j.franke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-e2e-flow-role-clarity/07-CONTEXT.md
@.planning/phases/07-e2e-flow-role-clarity/07-RESEARCH.md
@packages/arios-cli/templates/.claude/commands/arios/arios.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance /arios resume flow with friendly prompting</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/arios.md</files>
  <action>
Rewrite the Resume Flow section in /arios to be more friendly and structured:

1. Update "1. Resume Flow" section with enhanced experience:

```markdown
### 1. Resume Flow (STATE.md exists with frontmatter)

Read @.planning/STATE.md and parse the YAML frontmatter.

**Extract from frontmatter:**
- phase, phaseName (current position)
- planIndex, totalPlans (progress within phase)
- totalPhases (overall progress)
- status (e.g., "in-progress", "ready-for-planning")
- lastActivity (when last worked on)

**Display welcome message:**
```
## Welcome Back

You were working on:

| Progress | Phase | Status |
|----------|-------|--------|
| {phase}/{totalPhases} | {phaseName} | {status} |

**Last activity:** {lastActivity}
**Next action:** {determined from status - see below}

---

**Options:**

1. **Continue** - {action based on status}
2. **Status** - See full project overview
3. **Other** - Start something different

What would you like to do? (1/2/3):
```

**Determine "Next action" from status:**
- `ready-for-planning` -> "Plan this phase"
- `ready-for-execution` -> "Execute the plan"
- `in-progress` -> "Continue execution"
- `phase-complete` -> "Start next phase"

**Handle user choice:**
- 1 (Continue): Route to appropriate command based on status
- 2 (Status): Run `/arios:status`
- 3 (Other): Show available commands with brief descriptions

**Conflict detection (existing logic):**
Keep the existing checksum validation. If conflict detected, show:
```
## State Changed

Something changed since your last session.

Current state: Phase {phase}, {status}
Expected checksum: {stored}
Actual checksum: {calculated}

**Options:**
1. **Continue with current state** - Proceed as-is
2. **Show details** - See what might have changed

What would you like to do? (1/2):
```
```

2. Update "Fresh Start Flow" to be equally friendly:

```markdown
### 3. Fresh Start Flow (no .planning/ directory)

**Display welcome message:**
```
## Welcome to ARIOS

**Detected:** {Greenfield|Brownfield} {stack info if any}

ARIOS helps you build software through:
- `/ideate` - Explore what to build
- `/plan` - Structure the approach
- `/execute` - Build it step by step

**To get started:**

Run `/arios:init` to initialize ARIOS for this project.

Would you like to initialize? (yes/no):
```
```

3. Update Report section to match the new friendly format

4. Keep the technical detection logic (greenfield/brownfield, tech stack) but present results in user-friendly way
  </action>
  <verify>Read arios.md and confirm: (1) "Welcome Back" message exists with table format, (2) Options 1/2/3 offered, (3) "Welcome to ARIOS" for fresh start, (4) friendly tone throughout</verify>
  <done>arios.md provides friendly, structured resume experience with clear options</done>
</task>

<task type="auto">
  <name>Task 2: Add status-to-action mapping</name>
  <files>packages/arios-cli/templates/.claude/commands/arios/arios.md</files>
  <action>
Add clear documentation for how status maps to next action:

1. Add section after workflow explaining status interpretation:

```markdown
## Status Interpretation

Map project status to suggested action:

| Status | Meaning | Suggested Action |
|--------|---------|------------------|
| `ready-for-planning` | Phase has CONTEXT.md, needs planning | `/plan {phase}` |
| `ready-for-execution` | Phase has PLAN.md, ready to build | `/execute {phase}` |
| `in-progress` | Execution started, waves remaining | `/execute {phase}` (continue) |
| `phase-complete` | All plans in phase done | `/ideate` for next phase |
| `blocked` | Issue preventing progress | Show blocker details |

**Autonomous routing:**
When user selects "Continue", route automatically:
- Read status from STATE.md
- Determine appropriate command from table above
- Execute that command (no additional confirmation needed)
```

2. Ensure the "Continue" option actually routes to the right command without asking again
  </action>
  <verify>Read arios.md and confirm status interpretation table exists with all status values and their mappings</verify>
  <done>arios.md has clear status-to-action mapping for autonomous routing</done>
</task>

</tasks>

<verification>
1. Read arios.md and verify "Welcome Back" message with progress table
2. Confirm three options offered (Continue, Status, Other)
3. Confirm status interpretation table with action mappings
4. Verify fresh start flow is equally friendly
5. Confirm no raw state dumps - always formatted and explained
6. Verify greenfield/brownfield detection preserved: arios.md still contains find command or equivalent detection logic for code files to distinguish greenfield vs brownfield projects (E2E-04)
</verification>

<success_criteria>
- /arios shows "Welcome Back" with progress table when resuming
- Options are numbered and clear (Continue, Status, Other)
- Status-to-action mapping enables autonomous routing on "Continue"
- Fresh start shows "Welcome to ARIOS" with initialization prompt
- Tone is friendly and helpful, not technical or terse
- Conflict detection preserved but presented clearly
- Greenfield/brownfield detection logic preserved and functional (E2E-04 coverage)
</success_criteria>

<output>
After completion, create `.planning/phases/07-e2e-flow-role-clarity/07-03-SUMMARY.md`
</output>
